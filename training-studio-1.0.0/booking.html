<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking - Elite Studio</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/templatemo-training-studio.css">
    <style>
        .booking-section {
            padding: 80px 0;
            background: #f7f7f7;
        }
        .booking-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin: 0 auto;
            max-width: 600px;
        }
        .booking-card h3 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: rgb(156, 13, 13);
        }
        .booking-card label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .booking-card input,
        .booking-card select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .booking-card .btn-main {
            background: rgb(156, 13, 13);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .booking-card .btn-main:hover {
            background: rgba(156, 13, 13, 0.9);
        }
        /* Hide booking type sections by default */
        #membership-fields, 
        #class-fields, 
        #session-fields {
            display: none;
        }
        /* Style for read-only date/time display */
        .date-time-display {
            background-color: #f8f9fa;
            border: 1px solid #ced4da;
            padding: 10px;
            border-radius: 5px;
            width: 100%;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- ***** Header Area Start ***** -->
    <header class="header-area header-sticky">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <!-- ***** Logo Start ***** -->
                        <a href="index.html" class="logo">Elite<em> Studio</em></a>
                        <!-- ***** Logo End ***** -->
                        <!-- ***** Menu Start ***** -->
                        <ul class="nav">
                            <li class="scroll-to-section"><a href="index.html" class="active">Home</a></li>
                            <li class="scroll-to-section"><a href="#features">About</a></li>
                            <li class="scroll-to-section"><a href="#our-classes">Classes</a></li>
                            <li class="scroll-to-section"><a href="#schedule">Schedules</a></li>
                            <li class="scroll-to-section"><a href="#membership">Membership</a></li>
                            <li class="scroll-to-section"><a href="#contact-us">Contact</a></li>
                            <li class="main-button"><a href="SignUp.html">Sign Up</a></li>
                        </ul>        
                        <a class='menu-trigger'>
                            <span>Menu</span>
                        </a>
                        <!-- ***** Menu End ***** -->
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <!-- ***** Header Area End ***** -->

    <!-- ***** Booking Section Starts ***** -->
    <section class="booking-section">
        <div class="container">
            <div class="booking-card">
                <h3>Complete Your Booking</h3>
                <form id="booking-form">
                    <!-- User Details -->
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" name="name" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required>
                    </div>

                    <!-- Booking Type -->
                    <div class="form-group">
                        <label for="booking-type">Booking Type</label>
                        <select id="booking-type" name="booking-type" required>
                            <option value="">Select booking type</option>
                            <option value="membership">Membership</option>
                            <option value="class">Class</option>
                            <option value="session">Online Session</option>
                        </select>
                    </div>

                    <!-- Membership Booking Fields -->
                    <div id="membership-fields" class="form-group">
                        <label for="membership">Select Membership Plan</label>
                        <select id="membership" name="membership"></select>
                    </div>

                    <!-- Class Booking Fields -->
                    <div id="class-fields" class="form-group">
                        <label for="class">Select Class</label>
                        <select id="class" name="class"></select>
                        <div class="form-group">
                            <label>Class Date</label>
                            <div class="date-time-display" id="class-date-display"></div>
                            <input type="hidden" id="class-date" name="class-date">
                        </div>
                        <div class="form-group">
                            <label>Class Time</label>
                            <div class="date-time-display" id="class-time-display"></div>
                            <input type="hidden" id="class-time" name="class-time">
                        </div>
                    </div>

                    <!-- Online Session Booking Fields -->
                    <div id="session-fields" class="form-group">
                        <label for="session">Select Online Session</label>
                        <select id="session" name="session"></select>
                        <div class="form-group">
                            <label>Session Date</label>
                            <div class="date-time-display" id="session-date-display"></div>
                            <input type="hidden" id="session-date" name="session-date">
                        </div>
                        <div class="form-group">
                            <label>Session Time</label>
                            <div class="date-time-display" id="session-time-display"></div>
                            <input type="hidden" id="session-time" name="session-time">
                        </div>
                    </div>

                    <!-- Payment Information -->
                    <div class="form-group">
                        <label for="payment-method">Payment Method</label>
                        <select id="payment-method" name="payment-method" required>
                            <option value="">Choose payment method</option>
                            <option value="tabby">Tabby</option>
                            <option value="tamara">Tamara</option>
                            <option value="mada">Mada</option>
                        </select>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn-main">Complete Booking</button>
                </form>
            </div>
        </div>
    </section>
    <!-- ***** Booking Section Ends ***** -->

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <!-- About Section -->
                <div class="col-lg-4 col-md-6">
                    <div class="footer-section">
                        <h4>About Elite Studio</h4>
                        <p>Elite Studio is your go-to fitness destination, offering state-of-the-art facilities, expert trainers, and personalized programs to help you achieve your fitness goals.</p>
                        <div class="social-icons">
                            <a href="#"><i class="fa fa-facebook"></i></a>
                            <a href="#"><i class="fa fa-twitter"></i></a>
                            <a href="#"><i class="fa fa-instagram"></i></a>
                            <a href="#"><i class="fa fa-linkedin"></i></a>
                        </div>
                    </div>
                </div>
    
                <!-- Quick Links -->
                <div class="col-lg-2 col-md-6">
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li><a href="#features">About</a></li>
                            <li><a href="#our-classes">Classes</a></li>
                            <li><a href="#schedule">Schedules</a></li>
                            <li><a href="#membership">Membership</a></li>
                            <li><a href="#contact-us">Contact</a></li>
                        </ul>
                    </div>
                </div>
    
                <!-- Contact Info -->
                <div class="col-lg-3 col-md-6">
                    <div class="footer-section">
                        <h4>Contact Us</h4>
                        <ul class="contact-info">
                            <li><i class="fa fa-map-marker"></i> 123 Fitness Street, Rio de Janeiro, Brazil</li>
                            <li><i class="fa fa-phone"></i> +55 123 456 789</li>
                            <li><i class="fa fa-envelope"></i> info@elitestudio.com</li>
                        </ul>
                    </div>
                </div>
    
                <!-- Newsletter -->
                <div class="col-lg-3 col-md-6">
                    <div class="footer-section">
                        <h4>Newsletter</h4>
                        <p>Subscribe to our newsletter to get the latest updates and offers.</p>
                        <form class="newsletter-form">
                            <input type="email" placeholder="Your Email" required>
                            <button type="submit"><i class="fa fa-paper-plane"></i></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- ***** Footer Ends ***** -->

    <!-- JavaScript -->
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            // Load options from APIs
            await loadOptions("membership", "https://localhost:7020/api/Membership");
            await loadClasses();
            await loadSessions();
            
            // Set up event listener for booking type change
            document.getElementById("booking-type").addEventListener("change", function () {
                document.getElementById("membership-fields").style.display = 
                    (this.value === "membership") ? "block" : "none";
                document.getElementById("class-fields").style.display = 
                    (this.value === "class") ? "block" : "none";
                document.getElementById("session-fields").style.display = 
                    (this.value === "session") ? "block" : "none";
            });
            
            // Set up form submission
            document.getElementById("booking-form").addEventListener("submit", async function (event) {
                event.preventDefault();
                
                // Gather form data
                const formData = new FormData(this);
                const data = Object.fromEntries(formData.entries());
                
                try {
                    // Send booking data to API
                    const response = await fetch("https://localhost:7020/api/Booking", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(data)
                    });
                    
                    if (response.ok) {
                        alert("Booking successful!");
                        // Optionally redirect to confirmation page
                        // window.location.href = "confirmation.html";
                    } else {
                        alert("Booking failed. Please try again.");
                    }
                } catch (error) {
                    console.error("Error:", error);
                    alert("An error occurred. Please try again.");
                }
            });
        });
        
        // Function to load options from API
        async function loadOptions(id, url) {
            const select = document.getElementById(id);
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error("Network response was not ok");
                
                const data = await response.json();
                select.innerHTML = '<option value="">Select an option</option>';
                
                data.forEach(item => {
                    const option = document.createElement("option");
                    option.value = item.id;
                    option.textContent = `${item.name || item.title} - $${item.price}`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error(`Failed to load ${id}:`, error);
                select.innerHTML = '<option value="">Error loading options</option>';
            }
        }

        // Function to load classes with date/time information
        async function loadClasses() {
            const select = document.getElementById("class");
            try {
                const response = await fetch("https://localhost:7020/api/Class");
                if (!response.ok) throw new Error("Network response was not ok");
                
                const data = await response.json();
                select.innerHTML = '<option value="">Select a class</option>';
                
                data.forEach(cls => {
                    // Assuming your Class model has startDateTime or similar property
                    const classDate = new Date(cls.startDateTime || cls.date);
                    const option = document.createElement("option");
                    option.value = cls.id;
                    option.textContent = `${cls.name || cls.title} - $${cls.price || '0'}`;
                    option.dataset.date = classDate.toLocaleDateString();
                    option.dataset.time = classDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    option.dataset.fullDate = (cls.startDateTime || cls.date).split('T')[0];
                    option.dataset.fullTime = (cls.startDateTime || cls.date).split('T')[1].substring(0, 5);
                    select.appendChild(option);
                });
                
                // Add event listener to show class date when selected
                select.addEventListener("change", function() {
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption.value) {
                        document.getElementById("class-date-display").textContent = selectedOption.dataset.date;
                        document.getElementById("class-date").value = selectedOption.dataset.fullDate;
                        document.getElementById("class-time-display").textContent = selectedOption.dataset.time;
                        document.getElementById("class-time").value = selectedOption.dataset.fullTime;
                    } else {
                        document.getElementById("class-date-display").textContent = "";
                        document.getElementById("class-date").value = "";
                        document.getElementById("class-time-display").textContent = "";
                        document.getElementById("class-time").value = "";
                    }
                });
            } catch (error) {
                console.error("Failed to load classes:", error);
                select.innerHTML = '<option value="">Error loading classes</option>';
            }
        }

        // Function to load sessions with date/time information
        async function loadSessions() {
            const select = document.getElementById("session");
            try {
                const response = await fetch("https://localhost:7020/api/OnlineSession");
                if (!response.ok) throw new Error("Network response was not ok");
                
                const data = await response.json();
                select.innerHTML = '<option value="">Select an online session</option>';
                
                data.forEach(session => {
                    const sessionDate = new Date(session.sessionDateTime);
                    const option = document.createElement("option");
                    option.value = session.id;
                    option.textContent = `${session.title} with ${session.trainerName || 'Trainer'} - $${session.price}`;
                    option.dataset.date = sessionDate.toLocaleDateString();
                    option.dataset.time = sessionDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    option.dataset.fullDate = session.sessionDateTime.split('T')[0];
                    option.dataset.fullTime = session.sessionDateTime.split('T')[1].substring(0, 5);
                    select.appendChild(option);
                });
                
                // Add event listener to show session date when selected
                select.addEventListener("change", function() {
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption.value) {
                        document.getElementById("session-date-display").textContent = selectedOption.dataset.date;
                        document.getElementById("session-date").value = selectedOption.dataset.fullDate;
                        document.getElementById("session-time-display").textContent = selectedOption.dataset.time;
                        document.getElementById("session-time").value = selectedOption.dataset.fullTime;
                    } else {
                        document.getElementById("session-date-display").textContent = "";
                        document.getElementById("session-date").value = "";
                        document.getElementById("session-time-display").textContent = "";
                        document.getElementById("session-time").value = "";
                    }
                });
            } catch (error) {
                console.error("Failed to load sessions:", error);
                select.innerHTML = '<option value="">Error loading sessions</option>';
            }
        }
    </script>
</body>
</html>